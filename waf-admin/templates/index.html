<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAF Dashboard - NexusWAF</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <a href="/" class="navbar-brand" style="display: flex; align-items: center; gap: 0.75rem;"><svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 0 10px rgba(6, 182, 212, 0.6));"><path d="M16 2L4 8V14C4 23 16 30 16 30C16 30 28 23 28 14V8L16 2Z" fill="url(#gradient)" stroke="#0ea5e9" stroke-width="1.5"/><defs><linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#06b6d4;stop-opacity:1" /><stop offset="100%" style="stop-color:#0ea5e9;stop-opacity:1" /></linearGradient></defs></svg>NexusWAF</a>
            <ul class="navbar-nav">
                <li><a href="/" class="nav-link active">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/config" class="nav-link">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
                <li><a href="/logs" class="nav-link">–õ–æ–≥–∏</a></li>
                <li><a href="/stats" class="nav-link">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Stat Cards -->
        <div class="dashboard">
            <div class="card stat-card">
                <div style="font-size: 2.5rem; margin-bottom: 1rem;"></div>
                <div class="stat-number" id="totalRequests">{{.Stats.TotalRequests}}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</div>
            </div>
            <div class="card stat-card">
                <div style="font-size: 2.5rem; margin-bottom: 1rem;"></div>
                <div class="stat-number" id="blockedRequests">{{.Stats.BlockedRequests}}</div>
                <div class="stat-label">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</div>
            </div>
            <div class="card stat-card">
                <div style="font-size: 2.5rem; margin-bottom: 1rem;"></div>
                <div class="stat-number" id="blockRate">
                    {{if gt .Stats.TotalRequests 0}}
                        {{percent .Stats.BlockedRequests .Stats.TotalRequests}}%
                    {{else}}0.00%{{end}}
                </div>
                <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</div>
            </div>
        </div>

        <!-- Protection Status -->
        <div class="card">
            <h2>üõ°Ô∏è –°—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã</h2>
            <div class="protection-grid">
                <div class="protection-item" data-status="{{if .Config.EnableSQLi}}active{{else}}inactive{{end}}">
                    <div style="font-size: 1.5rem;">{{if .Config.EnableSQLi}}‚úì{{else}}‚úï{{end}}</div>
                    <div>
                        <div style="color: #0ea5e9; font-weight: 600;">SQL Injection</div>
                        <div style="color: #94a3b8; font-size: 0.85rem;">{{if .Config.EnableSQLi}}–ê–∫—Ç–∏–≤–Ω–æ{{else}}–û—Ç–∫–ª—é—á–µ–Ω–æ{{end}}</div>
                    </div>
                </div>
                <div class="protection-item" data-status="{{if .Config.EnableXSS}}active{{else}}inactive{{end}}">
                    <div style="font-size: 1.5rem;">{{if .Config.EnableXSS}}‚úì{{else}}‚úï{{end}}</div>
                    <div>
                        <div style="color: #0ea5e9; font-weight: 600;">XSS Protection</div>
                        <div style="color: #94a3b8; font-size: 0.85rem;">{{if .Config.EnableXSS}}–ê–∫—Ç–∏–≤–Ω–æ{{else}}–û—Ç–∫–ª—é—á–µ–Ω–æ{{end}}</div>
                    </div>
                </div>
                <div class="protection-item" data-status="{{if .Config.EnableCMDi}}active{{else}}inactive{{end}}">
                    <div style="font-size: 1.5rem;">{{if .Config.EnableCMDi}}‚úì{{else}}‚úï{{end}}</div>
                    <div>
                        <div style="color: #0ea5e9; font-weight: 600;">Command Injection</div>
                        <div style="color: #94a3b8; font-size: 0.85rem;">{{if .Config.EnableCMDi}}–ê–∫—Ç–∏–≤–Ω–æ{{else}}–û—Ç–∫–ª—é—á–µ–Ω–æ{{end}}</div>
                    </div>
                </div>
                <div class="protection-item" data-status="{{if .Config.EnablePath}}active{{else}}inactive{{end}}">
                    <div style="font-size: 1.5rem;">{{if .Config.EnablePath}}‚úì{{else}}‚úï{{end}}</div>
                    <div>
                        <div style="color: #0ea5e9; font-weight: 600;">Path Traversal</div>
                        <div style="color: #94a3b8; font-size: 0.85rem;">{{if .Config.EnablePath}}–ê–∫—Ç–∏–≤–Ω–æ{{else}}–û—Ç–∫–ª—é—á–µ–Ω–æ{{end}}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Configuration -->
        <div class="card">
            <h2>‚öôÔ∏è –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1.5rem;">
                <div style="padding: 1.5rem; background: rgba(6, 182, 212, 0.05); border-radius: 8px; border: 1px solid rgba(6, 182, 212, 0.1);">
                    <div style="color: #94a3b8; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">–ó–∞—â–∏—â–∞–µ–º–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                    <div style="color: #0ea5e9; font-weight: 600; word-break: break-all; font-family: 'Monaco', 'Courier New', monospace;">{{.Config.TargetURL}}</div>
                </div>
                <div style="padding: 1.5rem; background: rgba(6, 182, 212, 0.05); border-radius: 8px; border: 1px solid rgba(6, 182, 212, 0.1);">
                    <div style="color: #94a3b8; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">–ü–æ—Ä—Ç WAF</div>
                    <div style="color: #0ea5e9; font-weight: 600; font-size: 1.5rem; font-family: 'Monaco', 'Courier New', monospace;">{{.Config.ListenPort}}</div>
                </div>
            </div>
            <div style="margin-top: 2rem;">
                <a href="/config" class="btn btn-primary">‚öôÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
        </div>

        <!-- System Status -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
            <div class="card">
                <h3>–°–∏—Å—Ç–µ–º–∞</h3>
                <div style="margin-top: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid rgba(6, 182, 212, 0.1);">
                        <span style="color: #94a3b8;">–°—Ç–∞—Ç—É—Å</span>
                        <span style="color: #10b981; font-weight: 600;">‚óè  –ê–∫—Ç–∏–≤–Ω–∞</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid rgba(6, 182, 212, 0.1);">
                        <span style="color: #94a3b8;">–í–µ—Ä—Å–∏—è</span>
                        <span style="color: #0ea5e9; font-weight: 600;">v2.0.0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0;">
                        <span style="color: #94a3b8;">–û–±–Ω–æ–≤–ª–µ–Ω–∏—è</span>
                        <span style="color: #10b981; font-weight: 600;">–ê–∫—Ç—É–∞–ª—å–Ω–æ</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>üì± –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem;">
                    <a href="/logs" style="padding: 1rem; background: rgba(6, 182, 212, 0.1); border-radius: 8px; color: #0ea5e9; text-decoration: none; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;" onmouseover="this.style.background='rgba(6, 182, 212, 0.2)'; this.style.transform='translateX(5px)'" onmouseout="this.style.background='rgba(6, 182, 212, 0.1)'; this.style.transform='translateX(0)'">
                        –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    </a>
                    <a href="/stats" style="padding: 1rem; background: rgba(6, 182, 212, 0.1); border-radius: 8px; color: #0ea5e9; text-decoration: none; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;" onmouseover="this.style.background='rgba(6, 182, 212, 0.2)'; this.style.transform='translateX(5px)'" onmouseout="this.style.background='rgba(6, 182, 212, 0.1)'; this.style.transform='translateX(0)'">
                        –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebSocket –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        const ws = new WebSocket(`ws://${window.location.host}/api/ws`);
        
        ws.onmessage = function(event) {
            const stats = JSON.parse(event.data);
            
            // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —á–∏—Å–µ–ª
            animateValue('totalRequests', parseInt(document.getElementById('totalRequests').textContent), stats.total_requests, 500);
            animateValue('blockedRequests', parseInt(document.getElementById('blockedRequests').textContent), stats.blocked_requests, 500);
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            let blockRate = "0.00";
            if (stats.total_requests > 0) {
                blockRate = ((stats.blocked_requests / stats.total_requests) * 100).toFixed(2);
            }
            animateValue('blockRate', parseFloat(document.getElementById('blockRate').textContent), parseFloat(blockRate), 500);
        };

        function animateValue(elementId, start, end, duration) {
            let startTimestamp = null;
            const element = document.getElementById(elementId);
            
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                
                const isPercentage = element.id === 'blockRate';
                const value = Math.floor(progress * (end - start) + start);
                
                if (isPercentage) {
                    element.textContent = (parseFloat(value) + (end - start) * progress).toFixed(2) + '%';
                } else {
                    element.textContent = value;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(step);
                }
            };
            
            requestAnimationFrame(step);
        }
    </script>
</body>
</html>